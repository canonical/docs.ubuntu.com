<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Additional Configuration &mdash; MAAS 1.9 documentation</title>
    
    <link rel="stylesheet" href="/static/maas-1.9/flasky.css" type="text/css" />
    <link rel="stylesheet" href="/static/maas-1.9/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://assets.ubuntu.com/sites/guidelines/css/latest/ubuntu-styles.css" type="text/css" />
    <link rel="stylesheet" href="https://assets.ubuntu.com/sites/ubuntu/latest/u/css/global.css" type="text/css" />
    <link rel="stylesheet" href="/static/maas-1.9/css/main.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="/static/maas-1.9/jquery.js"></script>
    <script type="text/javascript" src="/static/maas-1.9/underscore.js"></script>
    <script type="text/javascript" src="/static/maas-1.9/doctools.js"></script>
    <link rel="shortcut icon" href="/static/maas-1.9/maas.ico"/>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="MAAS 1.9 documentation" href="index.html" />
    <link rel="next" title="Cluster Configuration" href="cluster-configuration.html" />
    <link rel="prev" title="Installing MAAS" href="install.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="cluster-configuration.html" title="Cluster Configuration"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="install.html" title="Installing MAAS"
             accesskey="P">previous</a> |</li>
  <li class="nav-item nav-item-0">
    <a href="/maas/">Latest documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
  </li>
  <li class="nav-item nav-item-0">
    <a href="index.html">MAAS 1.9 documentation</a>
  </li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="additional-configuration">
<h1>Additional Configuration<a class="headerlink" href="configure.html#additional-configuration" title="Permalink to this headline">¶</a></h1>
<div class="section" id="manual-dhcp-configuration">
<span id="manual-dhcp"></span><h2>Manual DHCP configuration<a class="headerlink" href="configure.html#manual-dhcp-configuration" title="Permalink to this headline">¶</a></h2>
<p>DHCP is needed in order for MAAS to boot and control nodes.  However, there
are some circumstances under which you may not wish a cluster controller to
handle DHCP address assignments for the network.  In these instances, the
existing DHCP server for the network will need its configuration altered to
allow MAAS to enlist and control nodes automatically.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you don&#8217;t let MAAS manage DHCP, then MAAS will not be able to allocate
its <a class="reference internal" href="cluster-configuration.html#static-ip-address"><span>static IP addresses</span></a> to Nodes.</p>
</div>
<p>At the very least the &#8220;filename&#8221; option should be set to &#8220;pxelinux.0&#8221;.</p>
<p>How to configure this depends on what software you use as a DHCP server.  If
you are using the ISC DHCP server, for example, the configuration entry might
look something like this:</p>
<div class="highlight-python"><div class="highlight"><pre>subnet 192.168.122.0 netmask 255.255.255.0 {
    filename &quot;pxelinux.0&quot;;
    option subnet-mask 255.255.255.0;
    option broadcast-address 192.168.122.255;
    option domain-name-servers 192.168.122.136;
    range dynamic-bootp 192.168.122.5 192.168.122.135;
}
</pre></div>
</div>
<p>When doing this, leave the cluster controller&#8217;s interface in the &#8220;unmanaged&#8221;
state.</p>
<p>If your cluster controller is in charge of nodes on more than one network
through different network interfaces, there is an additional complication.
Without the DHCP server built into the cluster controller, MAAS may not
know which of the cluster controller&#8217;s IP addresses each node should use
for downloading its installer image.  If you want to support this situation,
ensure that all of the nodes can reach all of the cluster controller&#8217;s
network addresses.</p>
</div>
<div class="section" id="ssl-support">
<span id="ssl"></span><h2>SSL Support<a class="headerlink" href="configure.html#ssl-support" title="Permalink to this headline">¶</a></h2>
<p>If you want secure access to your MAAS web UI/API, you need to do a few
things. First, turn on SSL support in Apache:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo a2enmod ssl
</pre></div>
</div>
<p>Ensure that the Apache config file from <code class="docutils literal"><span class="pre">etc/maas/maas-http.conf</span></code> is
included in <code class="docutils literal"><span class="pre">/etc/apache2/conf.d/</span></code>, then set the default URL using the
<code class="docutils literal"><span class="pre">maas-region-admin</span></code> command to use <code class="docutils literal"><span class="pre">https</span></code> instead of <code class="docutils literal"><span class="pre">http</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ maas-region-admin local_config_set \
&gt;   --maas-url=&quot;https://localhost:5240/MAAS&quot;
</pre></div>
</div>
<p>Now, restart Apache:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo service apache2 restart
</pre></div>
</div>
<p>At this point you will be able to access the MAAS web server using https but
the default SSL certificate is insecure.  Please generate your own and then
edit <code class="docutils literal"><span class="pre">/etc/apache2/conf.d/maas-http.conf</span></code> to set the location of the
certificate.</p>
</div>
<div class="section" id="choosing-a-series-to-install">
<h2>Choosing a series to install<a class="headerlink" href="configure.html#choosing-a-series-to-install" title="Permalink to this headline">¶</a></h2>
<p>You may have some specific reason to choose a particular version of Ubuntu
to install on your nodes, perhaps based around package availability,
hardware support or some other reason.</p>
<p>It is possible to choose a specific series from those available in a
number of ways.</p>
<div class="section" id="from-the-user-interface">
<h3>From the user interface<a class="headerlink" href="configure.html#from-the-user-interface" title="Permalink to this headline">¶</a></h3>
<p>The web-based user interface makes it easy to select which Ubuntu series you
wish to install on an individual node. When either adding a node
manually, or on the node page when the node has been automatically
discovered but before it is accepted, there is a drop down menu to select
the version of Ubuntu you wish to install.</p>
<img alt="/static/maas-1.9/series.png" src="_images/series.png" />
<p>The menu will always list all the currently available series according
to which boot images are available.</p>
</div>
<div class="section" id="using-the-maas-command">
<h3>Using the maas command<a class="headerlink" href="configure.html#using-the-maas-command" title="Permalink to this headline">¶</a></h3>
<p>It is also possible to select a series using the maas command. This
can be done on a per node basis with:</p>
<div class="highlight-python"><div class="highlight"><pre>$ maas &lt;profile&gt; node update &lt;system_id&gt; distro_series=&quot;&lt;value&gt;&quot;
</pre></div>
</div>
<p>Where the string contains one of the valid, available distro series (e.g.
&#8220;trusty&#8221;) or is empty for the default value.</p>
</div>
</div>
<div class="section" id="altering-the-preseed-file">
<span id="preseed"></span><h2>Altering the Preseed file<a class="headerlink" href="configure.html#altering-the-preseed-file" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not try to alter the preseed files if you don&#8217;t have a good
understanding of what you are doing. Altering the installed version
of Ubuntu can prevent MAAS from working as intended, and may have
security and stability consequences.</p>
</div>
<p>When MAAS commissions a node it installs a version of Ubuntu. The
installation is performed using a &#8216;preseed&#8217; file, which is
effectively a list of answers to the questions you would get were
you to run the installer manually.
The preseed file used by MAAS is carefully made so that the
target node can be brought up and do all the jobs expected of it.
However, in exceptional circumstances, you may wish to alter the
pressed file to work around some issue.
There are actually two preseed files, stored here:</p>
<div class="highlight-python"><div class="highlight"><pre>/etc/maas/preseeds/generic
/etc/maas/preseeds/preseed-master
</pre></div>
</div>
<p>The generic file actually references the preseed-master file, and is
used to set conditional parameters based on the type of series and
architecture to install as well as to define the minimum set of install
packages and to tidy up the PXE boot process if that has been used for
the node. Unless you have a specific need to change where install
packages come from, you should not need to edit this file.</p>
<p>For the more usual sorts of things you may wish to change, you should
edit the preseed-master file. For example, depending on your network
you may wish to change the clock settings:</p>
<div class="highlight-python"><div class="highlight"><pre># Local clock (set to UTC and use ntp)
d-i     clock-setup/utc boolean true
d-i     clock-setup/ntp boolean true
d-i     clock-setup/ntp-server  string ntp.ubuntu.com
</pre></div>
</div>
<p>Having consistent clocks is very important to the working of your MAAS
system overall. If your nodes however cannot freely access the Internet,
the supplied NTP server is not going to be very useful, and you may
find it better to run an ntp service on the MAAS controller and change
the <cite>ntp.ubuntu.com</cite> in the last line for a more appropriate server.</p>
<p>One thing you may wish to alter in the preseed file is the disk
partitioning. This is a simple recipe that creates a swap partition and
uses the rest of the disk for one large root filesystem:</p>
<div class="highlight-python"><div class="highlight"><pre>partman-auto/text/atomic_scheme ::

500 10000 1000000 ext3
        $primary{ }
        $bootable{ }
        method{ format }
        format{ }
        use_filesystem{ }
        filesystem{ ext3 }
        mountpoint{ / } .

64 512 300% linux-swap
        method{ swap }
        format{ } .
</pre></div>
</div>
<p>Here the root partition must be at least 500 mb, and has effectively no
maximum size. The swap partition ranges from 64 MB to 3 times the system&#8217;s
ram.
Adding <cite>$bootable{ }</cite> to make the partition bootable, and $primary{ }
marks it as the primary partition. The other specifiers used are:</p>
<dl class="docutils">
<dt><em>method{ format }</em></dt>
<dd>Used to make the partition be formatted. For swap partitions,
change it to &#8220;swap&#8221;. To create a new partition but do not
format it, change &#8220;format&#8221; to &#8220;keep&#8221; (such a partition can be
used to reserve for future use some disk space).</dd>
<dt><em>format{ }</em></dt>
<dd>Also needed to make the partition be formatted.</dd>
<dt><em>use_filesystem{ }</em></dt>
<dd>Specifies that the partition has a filesystem on it.</dd>
<dt><em>filesystem{ ext3 }</em></dt>
<dd>Specifies the filesystem to put on the partition.</dd>
<dt><em>mountpoint{ / }</em></dt>
<dd>Where to mount the partition.</dd>
</dl>
<p>For more information on preseed options, you should refer to
<a class="reference external" href="https://help.ubuntu.com/12.04/installation-guide/i386/preseed-contents.html">the official Ubuntu documentation</a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Future versions of MAAS are likely to replace this type of automatic
installation with a different installer.</p>
</div>
</div>
<div class="section" id="installing-additional-clusters">
<h2>Installing additional clusters<a class="headerlink" href="configure.html#installing-additional-clusters" title="Permalink to this headline">¶</a></h2>
<p>In an environment comprising large numbers of nodes, it is likely that you will
want to organise the nodes on a more distributed basis. The standard install of
the MAAS region controller includes a cluster controller, but it is
possible to add additional cluster controllers to the configuration, as
shown in the diagram below:</p>
<img alt="/static/maas-1.9/orientation_architecture-diagram.png" src="_images/orientation_architecture-diagram.png" />
<p>Each cluster controller will need to run on a separate Ubuntu server.
Installing and configuring the software is straightforward though:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo apt-get install maas-cluster-controller
</pre></div>
</div>
<p>This meta-package will install all the basic requirements of the system.
However, you may also wish or need to run DHCP and/or DNS services, in
which case you should also specify these:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo apt-get install maas-cluster-controller maas-dhcp maas-dns
</pre></div>
</div>
<div class="section" id="configuring-the-cluster-controller">
<h3>Configuring the cluster controller<a class="headerlink" href="configure.html#configuring-the-cluster-controller" title="Permalink to this headline">¶</a></h3>
<p>Once the packages are installed, the cluster controller needs to know
where to look for the region controller. This is achieved using <cite>dpkg</cite> to
configure the software:</p>
<div class="highlight-python"><div class="highlight"><pre>$ dpkg-reconfigure maas-cluster-controller
</pre></div>
</div>
<img alt="/static/maas-1.9/cluster-config.png" src="_images/cluster-config.png" />
<p>The configuration script should then bring up a screen where you can
enter the IP address of the region controller. Additionally, you will
need to import the distro image files locally for commissioning:</p>
<div class="highlight-python"><div class="highlight"><pre>$ maas maas node-groups import-boot-images
</pre></div>
</div>
<p>…and optionally set up the DHCP and DNS for the cluster by either:</p>
<dl class="docutils">
<dt><em>Using the web UI</em></dt>
<dd>Follow the instructions at <a class="reference internal" href="cluster-configuration.html"><em>Cluster Configuration</em></a> to
use the web UI to set up your cluster controller.</dd>
<dt><em>Using the command line client</em></dt>
<dd>First <a class="reference internal" href="maascli.html#api-key"><span>logging in to the API</span></a> and then
<a class="reference internal" href="maascli.html#cli-dhcp"><span>following this procedure</span></a></dd>
</dl>
</div>
</div>
<div class="section" id="client-side-dns-configuration">
<h2>Client-side DNS configuration<a class="headerlink" href="configure.html#client-side-dns-configuration" title="Permalink to this headline">¶</a></h2>
<p>When using a third party tool such as <code class="docutils literal"><span class="pre">juju</span></code> it will need to be able to
resolve the hostnames that the MAAS API returns to it.  In order for this to
happen, <em>client-side DNS</em> must be configured to point to MAAS&#8217;s DNS
server.  Generally speaking, this is a simple case of adding the following
line to the <code class="docutils literal"><span class="pre">/etc/resolv.conf</span></code> file on your client host:</p>
<div class="highlight-python"><div class="highlight"><pre>nameserver &lt;IP OF MAAS DNS HOST&gt;
</pre></div>
</div>
<p>replacing the &lt;IP OF MAAS DNS HOST&gt; with the actual IP address of the host
running the MAAS DNS server.</p>
<p>However, for hosts using the <code class="docutils literal"><span class="pre">resolvconf</span></code> package, please read its
documentation for more information.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<a style="border:0" title="MAAS Documentation Homepage" href="index.html"><img src="/static/maas-1.9/maas-logo-200.png" alt="MAAS logo"/></a>
<h2 style="text-align:center;">MAAS</h2>
<p style="font-style:italic;font-size:0.9em; text-align:center; margin-bottom:1.5em">Metal As A Service.</p>
<span id="version_switcher"></span>
<br/>
<br/>

  <ul>
<li><a class="reference internal" href="configure.html#">Additional Configuration</a><ul>
<li><a class="reference internal" href="configure.html#manual-dhcp-configuration">Manual DHCP configuration</a></li>
<li><a class="reference internal" href="configure.html#ssl-support">SSL Support</a></li>
<li><a class="reference internal" href="configure.html#choosing-a-series-to-install">Choosing a series to install</a><ul>
<li><a class="reference internal" href="configure.html#from-the-user-interface">From the user interface</a></li>
<li><a class="reference internal" href="configure.html#using-the-maas-command">Using the maas command</a></li>
</ul>
</li>
<li><a class="reference internal" href="configure.html#altering-the-preseed-file">Altering the Preseed file</a></li>
<li><a class="reference internal" href="configure.html#installing-additional-clusters">Installing additional clusters</a><ul>
<li><a class="reference internal" href="configure.html#configuring-the-cluster-controller">Configuring the cluster controller</a></li>
</ul>
</li>
<li><a class="reference internal" href="configure.html#client-side-dns-configuration">Client-side DNS configuration</a></li>
</ul>
</li>
</ul>
<script type="text/javascript">
$(document).ready(function () {
  if (true) {
    $.ajaxSetup({cache: true});
    $.getScript('/static/maas-1.9/versions.js', function() {
      console.log( "Versions script loaded." );
      set_up_version_switcher('#version_switcher', 'docs');
    });
}
});
</script>

<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="install.html" title="previous chapter">Installing MAAS</a></li>
      <li>Next: <a href="cluster-configuration.html" title="next chapter">Cluster Configuration</a></li>
  </ul></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="/static/maas-1.9/configure.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="cluster-configuration.html" title="Cluster Configuration"
             >next</a></li>
        <li class="right" >
          <a href="install.html" title="Installing MAAS"
             >previous</a> |</li>
  <li class="nav-item nav-item-0">
    <a href="/maas/">Latest documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
  </li>
  <li class="nav-item nav-item-0">
    <a href="index.html">MAAS 1.9 documentation</a>
  </li>
 
      </ul>
    </div>
<footer class="global clearfix">
  <div class="legal clearfix">
    <p>&copy; Copyright 2012-2015, MAAS Developers. Ubuntu and Canonical are registered trademarks of
      <a href="http://canonical.com">Canonical Ltd</a>.
    </p>
    <p>
      Revision 4595
 (2016-08-24 14:59:26 +0000).
      Documentation generation date: 2016-08-24 16:22:23 +0100.
    </p>
  </div>
</footer>
  </body>
</html>