<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Adding nodes to the system &mdash; MAAS dev documentation</title>
    
    <link rel="stylesheet" href="/static/maas-1.9/flasky.css" type="text/css" />
    <link rel="stylesheet" href="/static/maas-1.9/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://assets.ubuntu.com/sites/guidelines/css/latest/ubuntu-styles.css" type="text/css" />
    <link rel="stylesheet" href="https://assets.ubuntu.com/sites/ubuntu/latest/u/css/global.css" type="text/css" />
    <link rel="stylesheet" href="/static/maas-1.9/css/main.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="/static/maas-1.9/jquery.js"></script>
    <script type="text/javascript" src="/static/maas-1.9/underscore.js"></script>
    <script type="text/javascript" src="/static/maas-1.9/doctools.js"></script>
    <link rel="shortcut icon" href="/static/maas-1.9/maas.ico"/>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="MAAS dev documentation" href="index.html" />
    <link rel="next" title="Using hardware-enablement kernels" href="hardware-enablement-kernels.html" />
    <link rel="prev" title="Boot images import configuration" href="bootsources.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="hardware-enablement-kernels.html" title="Using hardware-enablement kernels"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="bootsources.html" title="Boot images import configuration"
             accesskey="P">previous</a> |</li>
  <li class="nav-item nav-item-0">
    <a href="http://maas.io/docs/">Latest documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
  </li>
  <li class="nav-item nav-item-0">
    <a href="index.html">MAAS dev documentation</a>
  </li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="adding-nodes-to-the-system">
<h1>Adding nodes to the system<a class="headerlink" href="nodes.html#adding-nodes-to-the-system" title="Permalink to this headline">¶</a></h1>
<p>Now that the MAAS controller is running, we need to make the nodes
aware of MAAS and vice-versa. If you have set up DHCP correctly, and
your nodes can boot via <a class="reference external" href="http://en.wikipedia.org/wiki/Preboot_Execution_Environment">PXE</a> then things really couldn&#8217;t be much easier
and you can use <a class="reference internal" href="nodes.html#auto-enlist"><span>the automatic discovery procedure</span></a>.
You do not need to install Ubuntu on nodes that you wish to add to MAAS
prior to enlistment.</p>
<p>To learn more about setting up DHCP, read the <a class="reference internal" href="cluster-configuration.html#cluster-configuration"><span>cluster configuration
documentation</span></a>.</p>
<div class="section" id="automatic-discovery">
<span id="auto-enlist"></span><h2>Automatic Discovery<a class="headerlink" href="nodes.html#automatic-discovery" title="Permalink to this headline">¶</a></h2>
<p>With nodes set to boot from a PXE image, they will start, look for a
DHCP server, receive the PXE boot details, boot the image, contact the
MAAS server and shut down.</p>
<p>During this process, the MAAS server will be passed information about
the node, including the architecture, MAC address and other details
which will be stored in the database of nodes. You can accept and
commission the nodes via the web interface.  When the nodes have been
accepted the selected series of Ubuntu will be installed.</p>
<p>To save time, you can also accept and commission all nodes from the
commandline. This requires that you first log in with the API key,
which <a class="reference internal" href="maascli.html#api-key"><span>you can retrieve from the web interface</span></a>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ maas maas nodes accept-all
</pre></div>
</div>
</div>
<div class="section" id="manually-add-nodes">
<span id="enlist-via-boot-media"></span><h2>Manually add nodes<a class="headerlink" href="nodes.html#manually-add-nodes" title="Permalink to this headline">¶</a></h2>
<p>If you know the MAC address of a node, you can manually enter details
about the node through the web interface. Click the <code class="docutils literal"><span class="pre">Add</span> <span class="pre">Node</span></code> button
to be taken to the &#8220;Add Node&#8221; form:</p>
<img alt="/static/maas-1.9/add-node.png" src="_images/add-node.png" />
</div>
<div class="section" id="virtual-machine-nodes">
<h2>Virtual machine nodes<a class="headerlink" href="nodes.html#virtual-machine-nodes" title="Permalink to this headline">¶</a></h2>
<p>If you&#8217;re setting up virtual machines to use as nodes with MAAS, you need
to configure the power type as <code class="docutils literal"><span class="pre">virsh</span></code>.  For MAAS to be able to use
virsh, make sure you have the <code class="docutils literal"><span class="pre">libvirt-bin</span></code> package installed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are assembling a set of VMs for testing or development, make
sure they have at least 512 MB (768 MB If you are deploying 15.10)
to avoid failures during deployment.</p>
</div>
<p>The virsh power type takes two parameters:</p>
<dl class="docutils">
<dt>Power ID</dt>
<dd>The Power ID is the name of the virtual machine shown by
<code class="docutils literal"><span class="pre">sudo</span> <span class="pre">virsh</span> <span class="pre">list</span> <span class="pre">--all</span></code></dd>
<dt>Address</dt>
<dd>This is a libvirt connection string, such as
<code class="docutils literal"><span class="pre">qemu+ssh://ubuntu&#64;10.0.0.2/system</span></code> or <code class="docutils literal"><span class="pre">qemu:///system</span></code></dd>
</dl>
<img alt="/static/maas-1.9/virsh-config.png" src="_images/virsh-config.png" />
<p>If you want to use ssh you&#8217;ll need to generate a ssh key pair for the maas
user.  By default there is no home directory created for the maas user:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo mkdir /home/maas
$ sudo chown maas:maas /home/maas
</pre></div>
</div>
<p>Add a login shell for the maas user:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo chsh -s /bin/bash maas
</pre></div>
</div>
<p>Become the maas user and generate a SSH keypair:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo su - maas
$ ssh-keygen
</pre></div>
</div>
<p>Then add the public key to <code class="docutils literal"><span class="pre">/ubuntu/.ssh/authorized_keys</span></code> on the vm server
so virsh can use ssh without a password:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ssh-copy-id -i ~/.ssh/id_rsa ubuntu@10.0.0.2
</pre></div>
</div>
<p>As the maas user, test virsh commands against libvirt at 10.0.0.2:</p>
<div class="highlight-python"><div class="highlight"><pre>$ virsh -c qemu+ssh://ubuntu@10.0.0.2/system list --all
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<a style="border:0" title="MAAS Documentation Homepage" href="index.html"><img src="/static/maas-1.9/maas-logo-200.png" alt="MAAS logo"/></a>
<h2 style="text-align:center;">MAAS</h2>
<p style="font-style:italic;font-size:0.9em; text-align:center; margin-bottom:1.5em">Metal As A Service.</p>
<span id="version_switcher"></span>
<br/>
<br/>

  <ul>
<li><a class="reference internal" href="nodes.html#">Adding nodes to the system</a><ul>
<li><a class="reference internal" href="nodes.html#automatic-discovery">Automatic Discovery</a></li>
<li><a class="reference internal" href="nodes.html#manually-add-nodes">Manually add nodes</a></li>
<li><a class="reference internal" href="nodes.html#virtual-machine-nodes">Virtual machine nodes</a></li>
</ul>
</li>
</ul>
<script type="text/javascript">
$(document).ready(function () {
  if (true) {
    $.ajaxSetup({cache: true});
    $.getScript('/static/maas-1.9/versions.js', function() {
      console.log( "Versions script loaded." );
      set_up_version_switcher('#version_switcher', 'docs');
    });
}
});
</script>

<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="bootsources.html" title="previous chapter">Boot images import configuration</a></li>
      <li>Next: <a href="hardware-enablement-kernels.html" title="next chapter">Using hardware-enablement kernels</a></li>
  </ul></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="/static/maas-1.9/nodes.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="hardware-enablement-kernels.html" title="Using hardware-enablement kernels"
             >next</a></li>
        <li class="right" >
          <a href="bootsources.html" title="Boot images import configuration"
             >previous</a> |</li>
  <li class="nav-item nav-item-0">
    <a href="http://maas.io/docs/">Latest documentation</a>&nbsp;&nbsp;|&nbsp;&nbsp;
  </li>
  <li class="nav-item nav-item-0">
    <a href="index.html">MAAS dev documentation</a>
  </li>
 
      </ul>
    </div>
<footer class="global clearfix">
  <div class="legal clearfix">
    <p>&copy; Copyright 2012-2015, MAAS Developers. Ubuntu and Canonical are registered trademarks of
      <a href="http://canonical.com">Canonical Ltd</a>.
    </p>
    <p>
      Revision 4595
 (2016-08-24 14:59:26 +0000).
      Documentation generation date: 2016-08-24 16:22:23 +0100.
    </p>
  </div>
</footer>
  </body>
</html>